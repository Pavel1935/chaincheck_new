image: mcr.microsoft.com/playwright/python:v1.45.0

stages:
  - test

cache:
  key: "pip-cache"
  paths:
    - .cache/pip

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
  ALLURE_DIR: "allure-results"
  PLAYWRIGHT_BROWSERS_PATH: "/ms-playwright"

before_script:
  - pip install -r requirements.txt

smoke_api:
  stage: test
  script:
    - pytest -m smoke -q --maxfail=1 --alluredir=${ALLURE_DIR}
  artifacts:
    when: always
    expire_in: 7 days
    paths:
      - ${ALLURE_DIR}

smoke_ui:
  stage: test
  script:
    - pytest -m smoke_ui -q --alluredir=${ALLURE_DIR}
  artifacts:
    when: always
    expire_in: 7 days
    paths:
      - ${ALLURE_DIR}
      - videos
      - traces
      - screenshots
